# Product Requirements Document: AI-Powered Complaints Letter Generator

## Project Overview
Multi-language complaints letter generator with AI-powered content generation, PostgreSQL data persistence, and comprehensive MCP server integration for Bulgarian and German markets.

## Technical Stack
- Frontend: React 18 + TypeScript + Vite + Tailwind CSS (Cyberpunk theme from SEO Agent)
- Backend: Node.js + Express + PostgreSQL (via postgres-c3 MCP)
- AI: Ollama MCP (local models) + OpenAI/Claude (premium tier)
- Task Management: Task Master MCP (project orchestration)
- Browser Testing: Playwright MCP (form validation, E2E tests)
- Web Research: Exa MCP (platform research, legal updates)
- Documentation: Context7 MCP (legal framework references)

## Core Features

### 1. Multi-Step Complaint Wizard
- 5-step form wizard with progress tracking
- Step 1: Complaint type selection (contractor, product, service, etc.)
- Step 2: Party details (names, business info, location)
- Step 3: Problem description (what went wrong, evidence)
- Step 4: Resolution attempts (contact history, responses)
- Step 5: Tone selection (professional, firm, aggressive, maximum)
- Real-time form validation using Playwright MCP for testing
- Data persistence via PostgreSQL MCP after each step

### 2. AI Letter Generation
- Primary: Ollama MCP integration for free tier (Llama 3.2 8B model)
- Premium: OpenAI/Claude API for enhanced quality
- Multi-language support: Bulgarian, German, English
- Template system with legal compliance checks
- Context-aware generation using Sequential Thinking MCP for complex cases
- Magic MCP for UI component generation

### 3. Database Integration (PostgreSQL)
- User accounts and authentication (JWT)
- Letter history and drafts storage
- Template library management
- Analytics tracking (letters generated, success rates)
- Platform effectiveness tracking
- User preferences and settings
- Database schema managed via postgres-c3 MCP

### 4. Review Platform Recommendations
- Dynamic platform list based on complaint type
- Bulgarian platforms: 17+ sites (Google, Facebook, MaistorPlus, etc.)
- German platforms: Research via Exa MCP for current sites
- Priority ranking (high/medium/low impact)
- Platform-specific guidance and tips
- Success rate tracking per platform

### 5. Legal Escalation Roadmap
- Timeline visualization of legal steps
- Country-specific consumer protection info
- Document checklist (evidence, receipts, photos)
- Small claims court guidance
- Lawyer directory integration (future)
- Updates via Context7 MCP for legal frameworks

### 6. Export & Delivery Options
- PDF generation with letterhead
- Plain text copy for emails
- WhatsApp/Viber formatted messages
- Print-optimized layout
- Cloud storage integration (future)

### 7. Analytics Dashboard
- Total letters generated
- Success rate tracking
- Popular complaint types
- Geographic distribution
- Platform effectiveness metrics
- User satisfaction scores

### 8. Testing & Quality
- Playwright MCP for E2E testing
- Form validation testing
- Multi-language content testing
- PDF generation validation
- Cross-browser compatibility
- Mobile responsiveness testing

## User Journey

### New User Flow
1. Land on homepage → See value proposition
2. Click "Start Complaint" → Begin wizard
3. Complete 5-step form → Generate letter
4. Preview letter → Make edits if needed
5. Export/Send letter → Get platform recommendations
6. Track resolution → Update success status

### Returning User Flow
1. Login → Dashboard
2. View letter history → Copy previous letters
3. Create new complaint → Pre-filled common fields
4. Generate variation → Different tone/approach
5. Track all complaints → Analytics view

## Database Schema (PostgreSQL)

### Core Tables
```sql
-- Users table
users (
  id, email, password_hash, name, language,
  country, created_at, subscription_tier
)

-- Complaints table
complaints (
  id, user_id, complaint_type, business_name,
  location, problem_description, amount_owed,
  evidence_list, contact_attempts, tone,
  language, status, created_at, updated_at
)

-- Generated letters table
letters (
  id, complaint_id, content, ai_provider,
  tone, language, version, created_at
)

-- Platform recommendations table
platform_recommendations (
  id, letter_id, platform_name, platform_url,
  priority, clicked, review_posted, created_at
)

-- Templates table
templates (
  id, name, category, language, content,
  variables, is_premium, usage_count, created_at
)

-- Analytics table
analytics (
  id, user_id, action_type, metadata,
  created_at
)
```

## MCP Server Integration Plan

### Task Master MCP
- Project task management and tracking
- Automated task generation from requirements
- Progress monitoring and reporting
- Integration with git for version control

### Ollama MCP
- Local AI model hosting (Llama 3.2 8B)
- Letter generation for free tier
- Privacy-first processing (no data leaves server)
- Multi-language model support

### PostgreSQL MCP (postgres-c3)
- Database operations and queries
- Schema management and migrations
- Connection pooling and optimization
- Data backup and recovery

### Playwright MCP
- E2E testing of complaint wizard
- Form validation testing
- Cross-browser compatibility checks
- Screenshot capture for documentation
- Automated regression testing

### Exa MCP
- Research German review platforms
- Legal framework updates
- Competitor analysis
- Market trends monitoring

### Context7 MCP
- Legal documentation references
- GDPR compliance guidelines
- Consumer protection laws
- Template legal phrases

### Sequential Thinking MCP
- Complex complaint analysis
- Multi-step reasoning for legal strategies
- Evidence evaluation
- Recommendation generation

### Magic MCP
- UI component generation from designs
- Rapid prototyping of new features
- Design system implementation
- Responsive layout generation

## Development Phases

### Phase 1: Foundation (Week 1)
- Set up project structure with Task Master
- Initialize PostgreSQL database with schema
- Copy design system from SEO Agent app
- Build basic React + Vite frontend
- Implement dark cyberpunk theme
- Create navigation and layout components

### Phase 2: Core Functionality (Week 2)
- Build 5-step wizard form
- Integrate Ollama MCP for letter generation
- Connect PostgreSQL for data persistence
- Implement letter preview and editing
- Add PDF export functionality
- Create platform recommendation engine

### Phase 3: Testing & Polish (Week 3)
- Playwright E2E test suite
- Multi-language content testing
- Performance optimization
- Accessibility improvements
- Mobile responsiveness
- Deploy to production

### Phase 4: Advanced Features (Week 4+)
- User authentication system
- Premium tier with OpenAI/Claude
- Analytics dashboard
- Template library
- Legal escalation timeline
- Platform effectiveness tracking

## Success Metrics

### Technical KPIs
- Letter generation time: <10 seconds (Ollama)
- Database query performance: <100ms
- Test coverage: >80%
- Accessibility score: WCAG AA compliant
- Mobile performance: 90+ Lighthouse score

### Business KPIs
- User acquisition: 500+ users in 3 months
- Letter generation: 1000+ letters/month
- Success rate: >70% positive outcomes
- Premium conversion: 5-10% of users
- User retention: 40% monthly active users

## Risk Mitigation

### Technical Risks
- Ollama model quality → Extensive prompt engineering and testing
- Database scalability → PostgreSQL optimization and indexing
- Multi-language accuracy → Native speaker review and validation
- Browser compatibility → Playwright cross-browser testing

### Legal Risks
- Defamation liability → Clear disclaimers and factual language only
- GDPR compliance → Minimal data collection, encryption at rest
- Legal advice concerns → "Not legal advice" disclaimers

### Business Risks
- Low adoption → Free tier with generous limits
- Competition → Unique multi-language and platform focus
- Monetization → Multiple revenue streams (premium, API, white-label)

## Future Enhancements
- Mobile apps (React Native)
- WhatsApp/Telegram bot integration
- Voice input for complaints
- AI-powered evidence analysis
- Blockchain verification for letters
- Integration with legal services
- B2B white-label offering
- API for third-party integration

## Conclusion
The Complaints Letter Generator combines powerful MCP server integrations to create a comprehensive solution for consumer complaints in Bulgarian and German markets. By leveraging Task Master for project management, Ollama for AI generation, PostgreSQL for data persistence, and Playwright for testing, we ensure a robust, scalable, and user-friendly application that addresses a real market need while maintaining high quality and legal compliance standards.